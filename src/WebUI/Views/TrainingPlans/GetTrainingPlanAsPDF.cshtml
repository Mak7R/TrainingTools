@model TrainingPlanViewModel

@{
    Layout = null;
}

@functions {
    public class ColorGenerator
    {
        private int _groupCount;
        private int _currentIndex;
        private const int DefaultMove = 124;

        public ColorGenerator(int groupCount)
        {
            _groupCount = groupCount;
            _currentIndex = 0;
        }

        public string NextColor()
        {
            var hue = (_currentIndex * 360.0 / _groupCount + DefaultMove) % 360;
            _currentIndex++;
            return HslToRgb(hue, 0.5, 0.75); // Saturation and Lightness can be adjusted
        }

        private string HslToRgb(double hue, double saturation, double lightness)
        {
            double chroma = (1 - Math.Abs(2 * lightness - 1)) * saturation;
            double x = chroma * (1 - Math.Abs((hue / 60.0) % 2 - 1));
            double m = lightness - chroma / 2;
            double r = 0, g = 0, b = 0;

            if (0 <= hue && hue < 60)
            {
                r = chroma;
                g = x;
            }
            else if (60 <= hue && hue < 120)
            {
                r = x;
                g = chroma;
            }
            else if (120 <= hue && hue < 180)
            {
                g = chroma;
                b = x;
            }
            else if (180 <= hue && hue < 240)
            {
                g = x;
                b = chroma;
            }
            else if (240 <= hue && hue < 300)
            {
                r = x;
                b = chroma;
            }
            else if (300 <= hue && hue < 360)
            {
                r = chroma;
                b = x;
            }

            r += m;
            g += m;
            b += m;

            return $"#{(int)(r * 255):X2}{(int)(g * 255):X2}{(int)(b * 255):X2}";
        }
    }
}

@{
    var groupColors = new Dictionary<Guid, string>();
    var colorGenerator = new ColorGenerator(10);

    string GetGroupColor(Guid groupId)
    {
        if (!groupColors.TryGetValue(groupId, out var color))
        {
            color = colorGenerator.NextColor();
            groupColors[groupId] = color;
        }
        return groupColors[groupId];
    }
}

<div class="container">
    <h2 class="text-center mb-3 d-block w-100">@Model.Author.Username/@Model.Title</h2>

    <div class="table-responsive border border-1 border-black">
        <table class="table table-bordered m-0" style="min-height: 60vh">
            <thead>
            <tr>
                @foreach (var block in Model.TrainingPlanBlocks)
                {
                    <th>@block.Name</th>
                }
            </tr>
            </thead>
            <tbody>
            @{
                var maxEntriesCount = Model.TrainingPlanBlocks.Any() ? Model.TrainingPlanBlocks.Max(b => b.TrainingPlanBlockEntries.Count) : 0;
            }
            @for (int i = 0; i < maxEntriesCount; i++)
            {
                <tr>
                    @foreach (var block in Model.TrainingPlanBlocks)
                    {
                        if (i < block.TrainingPlanBlockEntries.Count)
                        {
                            var entry = block.TrainingPlanBlockEntries[i];
                            var color = GetGroupColor(entry.Group.Id);
                            <td style="background-color: @color">
                                <div><strong>Group: </strong>@entry.Group.Name</div>
                                <div><strong>Description: </strong>@entry.Description</div>
                            </td>
                        }
                        else
                        {
                            <td>
                            
                            </td>
                        }
                    }
                </tr>
            }
            </tbody>
        </table>
    </div>

    <br/>
    <a href="https://github.com/Mak7R/TrainingTools" class="text-center fs-3 mt-3 d-block w-100">Generated by Mak7R/TrainingTools</a>
</div>


